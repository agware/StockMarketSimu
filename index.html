<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stock Market Simulation</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>

<script src="https://d3js.org/d3.v4.min.js"></script>

<div id="main-container">
    <div id="market-container" class="graph-container"></div>
    <div id="spirits-container" class="graph-container"></div>
    <div id="news-container" class="graph-container"></div>
    <div id="beer-container" class="graph-container"></div>
</div>

<script src="Simulation.js"></script>
<script>
    let stock = rnorm(0,0.1);
    let stockCollection = [];
    let secondCount = 0;
    let mean = 0;
    let vol = 0.25;

    let stockSettings = initStock(stockCollection);
    initNews();
    let beerSettings = initDrink('#beer-container');
    let spiritSettings = initDrink('#spirits-container');

    d3.timer(generateValues);

    function generateValues(timeElapsed) {
        let secondsElapsed = Math.floor(timeElapsed/500)/2;

        const secondsInHour = 360;
        const hours = 4;
        const maxTime = hours * secondsInHour;
        if(secondsElapsed >= maxTime) {
            // terminate value generation
            return true;
        }

        if(secondsElapsed > secondCount) {
            secondCount = secondsElapsed;
            stockCollection.push(stock);
            if(stockCollection.length > 100) {
                stockCollection.shift();
            }
            updateStock(stockCollection, stockSettings);
            stock += rnorm(mean, vol);
            stock = updateNews(secondCount, stock);
            updatePrices(secondCount, stock, beerSettings, spiritSettings);

            mean = updateMean(stock);

            vol = updateVol(secondCount, stockCollection);

        }
    }
</script>

</body>
</html>